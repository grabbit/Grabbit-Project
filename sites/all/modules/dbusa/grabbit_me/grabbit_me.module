<?

//Implementation of hook_grabbit_status_update
//$status the text of the status
function grabbit_me_grabbit_status_update($status, $tw_status_ch, $fb_status_ch,$uid){

  $extra_array=array();
  $extra_array['twitter']=$tw_status_ch;
  $extra_array['facebook']=$fb_status_ch;

  $extra_array['status']=$status;

  $extra=serialize($extra_array);

  db_query("INSERT INTO {grabbit_me} (uid,type,extra) VALUES (%d,'status','%s')",$uid,$extra);
	
}

//Implementation of hook_grabbit_facebook_comment
function grabbit_me_grabbit_facebook_comment($nid,$uid,$comment){
	
  $extra_array=array();
  $extra_array['nid']=$nid;
  $extra_array['type']='facebook';
  $extra_array['comment']=$comment;

  $extra=serialize($extra_array);

  db_query("INSERT INTO {grabbit_me} (uid,type,extra) VALUES (%d,'comment','%s')",$uid,$extra);

}

//Implementation of hook_grabbit_nodes_comment
function grabbit_me_grabbit_nodes_comment($nid,$comment,$uid){
	$extra_array=array();
	  $extra_array['nid']=$nid;
	  $extra_array['type']='node';
	  $extra_array['comment']=$comment;

	  $extra=serialize($extra_array);

	  db_query("INSERT INTO {grabbit_me} (uid,type,extra) VALUES (%d,'comment','%s')",$uid,$extra);
	
}

function grabbit_me_get_statuses($uid,$limit=10){
	
  $result = db_query("SELECT extra FROM {grabbit_me} WHERE uid=%d AND type='status' LIMIT %d",$uid,$limit);

  while($updates=db_fetch_object($result)){
    print_r($updates);	
  }
	
}


function grabbit_me_get_mentions($uid,$user_name,$limit=10){

  if($fuser = facebook_grabbit_get_fid($user->uid)){
	
      $module_name='facebook_grabbit';
	  require_once(drupal_get_path('module', $module_name)."/facebook/facebook.php");
	  require_once(drupal_get_path('module', $module_name)."/facebook/facebook_desktop.php");
	  include(drupal_get_path('module', $module_name)."/facebook/config.php");

	  $suser=$fuser->fid;
	  $session_key=$fuser->kid;
      try{
	
	    $facebook = new FacebookDesktop($api_key, $secret);
	
	    if ($facebook->set_user($suser, $session_key)!= null){
		  drupal_set_message("Facebook connection failed","error");
	    }
	    else{
		  $user_details = $facebook->api_client->users_getInfo($suser, 'last_name, first_name');
		  print_r($facebook);
		  print_r($user_details); 
		}
	
	  }catch(FacebookRestClientException $e){
		
	  }	
  }
	
  if($twitter_account = oauth_twitter_get_uid($user->uid))

  $result = db_query("SELECT extra FROM {grabbit_me} WHERE uid=%d AND type='status' LIMIT %d",$uid,$limit);

  while($updates=db_fetch_object($result)){
    print_r($updates);	
  }
	
}